############################################################################
# Title:            Bizbox: Reinstall | Reinstall apps Task                #
# Author(s):        btmarouane                                             #
# URL:              https://github.com/GrecoTechnology/Bizbox              #
# --                                                                       #
############################################################################
#                   GNU General Public License v3.0                        #
############################################################################
---
- name: Reinstall apps | Set app name
  set_fact:
    app: "{{ 'invoiceninjav5' if app_item in ['invoiceninja', 'invoice'] else app_item }}"

- name: Reinstall apps | Check role name
  stat:
    path: "{{ roles_path }}/{{ app }}"
  register: register_role_name

- name: Reinstall apps | Reinstall app
  block:
    - ansible.builtin.include_role:
        name: uninstall
      vars:
        apps: "{{ app }}"
      when: force is defined and force == 'true'
    - ansible.builtin.include_role:
        name: "{{ app }}"
  when: register_role_name.stat.exists and app not in {{ utils_apps }}
